_comp_cmd_yt-dlp() {
    local cur prev
    # Unused variables assigned by _comp_initialize.
    # shellcheck disable=SC2034
    local words cword comp_args was_split

    # ':' must be excluded from COMP_WORDBREAKS to handle :yt* keywords
    _comp_initialize -n : -s -- "$@" || return

    case "$prev" in
        -a | --batch-file | --download-archive | --cookies | --load-info-json \
                | --config-locations | --netrc-location | --ffmpeg-location \
                | --client-certificate | --client-certificate-key )
            _comp_compgen_filedir
            return
            ;;

        --plugin-dirs | --cache-dir )
            _comp_compgen_filedir -d
            return
            ;;

        * )
            case "$cur" in
                :* )
                    local -r keywords=(
                        :ytnotif{,ication}{,s}
                        :ytfav{,o{,u}rite}{,s}
                        :ytwatchlater
                        :ytrec{,ommended}
                        :ytsub{,scription}{,s}
                        :ythis{,tory}
                    )
                    _comp_compgen -- -W "${keywords[*]}"
                    _comp_ltrim_colon_completions "$cur"
                    return
                    ;;

                * )
                    local -r opts=( YT_DLP_FLAGS )
                    _comp_compgen -- -W "${opts[*]}"
                    return
                    ;;
            esac
            ;;
    esac
} \
    && complete -F _comp_cmd_yt-dlp yt-dlp
